---

---

<div class="newsletter">
  <form
    id="newsletter-form"
    name="newsletter-form"
    method="post"
    action="/api/newsletter"
    class="form-fields"
    aria-label="Newsletter Form"
    novalidate
  >
    <label for="name" class="sr-only field-label">Name</label>
    <input
      class="field-input field_name"
      maxlength="256"
      name="name"
      placeholder="name"
      type="text"
      id="name"
      aria-describedby="name-error"
    />
    <label for="email" class="sr-only field-label">Email Address</label>
    <input
      class="field-input field_email"
      maxlength="256"
      name="email"
      placeholder="mail@domain.com"
      type="email"
      id="email"
      required=""
      aria-describedby="email-error form-messages"
    />
    <input
      type="submit"
      data-wait="Please wait..."
      class="field-submit"
      value="Submit"
      id="submit-btn"
      aria-describedby="form-messages"
    />
  </form>
  <div
    class="messages"
    id="form-messages"
    role="status"
    aria-live="polite"
    aria-atomic="true"
  >
    <div
      class="form-success"
      tabindex="-1"
      role="region"
      aria-label="Newsletter Form success"
      id="success-message"
    >
      <p>Thank you! Your submission has been received!</p>
    </div>
    <div
      class="form-error"
      tabindex="-1"
      role="region"
      aria-label="Newsletter Form failure"
      id="error-message"
    >
      <p>Oops! Something went wrong while submitting the form.</p>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLInputElement;
  const successMessage = document.getElementById('success-message') as HTMLElement;
  const errorMessage = document.getElementById('error-message') as HTMLElement;
  const messagesContainer = document.getElementById('form-messages') as HTMLElement;
  const emailInput = document.getElementById('email') as HTMLInputElement;
  const nameInput = document.getElementById('name') as HTMLInputElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Reset previous states
      hideMessages();
      submitBtn.disabled = true;
      const originalValue = submitBtn.value;
      submitBtn.value = submitBtn.getAttribute('data-wait') || 'Please wait...';

      // Get form data
      const formData = {
        email: emailInput.value.trim(),
        name: nameInput.value.trim() || undefined,
      };

      // Basic client-side validation
      if (!formData.email) {
        showError('Gelieve een email adres in te voeren.');
        submitBtn.disabled = false;
        submitBtn.value = originalValue;
        return;
      }

      if (!isValidEmail(formData.email)) {
        showError('Gelieve een geldig email adres in te voeren.');
        submitBtn.disabled = false;
        submitBtn.value = originalValue;
        return;
      }

      try {
        const response = await fetch('/api/newsletter', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });

        let data;
        try {
          data = await response.json();
        } catch (parseError) {
          // If response is not JSON, show generic error
          showError('Er is een fout opgetreden. Probeer het later opnieuw.');
          submitBtn.disabled = false;
          submitBtn.value = originalValue;
          return;
        }

        if (data.success) {
          showSuccess(data.message || 'Bedankt! Je bent succesvol aangemeld voor onze nieuwsbrief.');
          form.reset();
        } else {
          showError(data.message || 'Er is een fout opgetreden. Probeer het later opnieuw.');
        }
      } catch (error) {
        console.error('Newsletter submission error:', error);
        showError('Er is een fout opgetreden bij het verbinden met de server. Probeer het later opnieuw.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.value = originalValue;
      }
    });
  }

  function isValidEmail(email: string): boolean {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  function showSuccess(message: string) {
    if (successMessage && messagesContainer) {
      const messageText = successMessage.querySelector('p');
      if (messageText) {
        messageText.textContent = message;
      }
      hideMessages();
      successMessage.style.display = 'block';
      messagesContainer.style.display = 'block';
      successMessage.focus();
    }
  }

  function showError(message: string) {
    if (errorMessage && messagesContainer) {
      const messageText = errorMessage.querySelector('p');
      if (messageText) {
        messageText.textContent = message;
      }
      hideMessages();
      errorMessage.style.display = 'block';
      messagesContainer.style.display = 'block';
      errorMessage.focus();
    }
  }

  function hideMessages() {
    if (successMessage) successMessage.style.display = 'none';
    if (errorMessage) errorMessage.style.display = 'none';
  }
</script>

<style>
  :root {
    --color-bg: white;
    --color-text: black;
    --color-border: #ccc;
    --color-bg-focus: #f0f0f0;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --color-bg: #121212;
      --color-text: white;
      --color-border: #d5d5d5;
      --color-bg-focus: #333;
    }
  }

  .newsletter {
    padding-top: 0.65rem;
  }

  .field-label {
    display: block;
    margin-bottom: 0.5rem;
  }

  .field-input {
    width: 100%;
    padding: 0.5rem 1rem;
    margin-bottom: 1rem;
    border: 2px solid var(--footer-text);
    background-color: var(--footer-bg);
    color: var(--footer-text);
    transition: all 1s cubic-bezier(0.215, 0.61, 0.355, 1);
    border-radius: 100vw;
  }

  .field-input:hover {
    /* box-shadow: inset 0px -4px 12px rgba(0,0,0,0.125); */
  }

  .field-input:focus {
    border-color: var(--footer-text);
    outline: none;
    background-color: var(--footer-bg);
    opacity: 0.8;
  }

  .field-submit {
    /* width: 100%; */
    padding: 0.75rem 0;
    border: none;
    /* border-radius: 4px; */

    color: var(--footer-text);
    background: transparent;
    font-weight: bold;
    text-decoration: underline;
    text-decoration-line: underline;
    text-decoration-style: solid 2px;
    text-underline-offset: 20%;
    cursor: pointer;
  }

  .field-submit:hover {
    /* background-color: var(--color-bg-focus); */
  }

  .messages {
    display: none;
    margin-top: 1rem;
  }

  .form-success,
  .form-error {
    padding: 0.75rem 1rem;
    border-radius: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .form-success {
    background-color: rgba(34, 197, 94, 0.1);
    color: rgb(22, 163, 74);
    border: 1px solid rgba(34, 197, 94, 0.3);
  }

  .form-error {
    background-color: rgba(239, 68, 68, 0.1);
    color: rgb(220, 38, 38);
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .form-success:focus,
  .form-error:focus {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }

  .field-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
</style>
