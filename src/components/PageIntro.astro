---
const { class: customClass } = Astro.props;
---

<section class={`page-intro page ${customClass}`}>
  <div class="grid gap-4 page content-baseline lg:grid-cols-2 lg:gap-12">
    <div class="col-1 col self-baseline">
      <slot name="column-one" />
    </div>
    <div class="self-auto col-2 col">
      <slot name="column-two" />
    </div>
  </div>
</section>

<style>
  .col-1 {
    font-size: var(--fs-3);
    line-height: 112.5%;
    color: var(--text);
    opacity: 0.8;
  }

  .col-2 {
    font-size: calc(2 * var(--fs-0));
    line-height: 112.5%;
    font-weight: 600;
    letter-spacing: -0.0125em;
    opacity: 0.8;
  }

  .page .col-1 {
    font-size: var(--fs-1);
    line-height: 112.5%;
    /* font-weight:600; */
    /* letter-spacing: -0.0125em; */
    color: var(--text);
  }
  .page .col-2 {
    font-size: var(--fs-0);
    line-height: 112.5%;
    color: var(--text);

    font-weight: 400;
  }

  section div > div {
    max-width: 70ch;
  }

  :global(.home .col h3) {
    margin-bottom: 2rem;
    font-size: var(--fs-4);
    line-height: 95%;
    font-weight: 400;
  }

  :global(.home .col h4) {
    font-size: var(--fs-2);
    font-weight: 400;
  }

  :global(.home .col p) {
    font-size: var(--fs-1);
    line-height: 112.5%;
  }

  /* Link styling in PageIntro */
  :global(.page-intro a) {
    text-decoration: underline;
    text-underline-offset: 0.25em;
    text-decoration-thickness: 1px;
    color: inherit;
    transition: opacity 0.2s ease;
  }

  :global(.page-intro a:hover) {
    opacity: 0.7;
  }

  /* Video hover link styling */
  :global(.link-with-video) {
    cursor: pointer;
  }

  /* Video preview container */
  :global(.video-hover-preview) {
    position: fixed;
    width: 200px;
    max-width: 200px;
    height: auto;
    pointer-events: none;
    z-index: 9999;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
  }

  :global(.video-hover-preview.visible) {
    opacity: 1;
  }

  :global(.video-hover-preview video) {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
  }
</style>

<script>
  function initVideoHover() {
    const linksWithVideo = document.querySelectorAll('a[data-video-url]');
    let videoElement: HTMLVideoElement | null = null;
    let videoContainer: HTMLDivElement | null = null;
    let currentLink: HTMLElement | null = null;

    function createVideoElement(videoUrl: string) {
      // Verwijder bestaande video als die er is
      if (videoContainer) {
        videoContainer.remove();
      }

      // Maak nieuwe video container
      videoContainer = document.createElement('div');
      videoContainer.className = 'video-hover-preview';
      document.body.appendChild(videoContainer);

      // Maak video element
      videoElement = document.createElement('video');
      videoElement.src = videoUrl;
      videoElement.muted = true;
      videoElement.loop = true;
      videoElement.autoplay = true;
      videoElement.playsInline = true;
      videoElement.setAttribute('playsinline', '');
      
      videoContainer.appendChild(videoElement);

      // Start video afspelen
      videoElement.play().catch(() => {
        // Video kan niet afspelen, verberg container
        if (videoContainer) {
          videoContainer.remove();
          videoContainer = null;
          videoElement = null;
        }
      });
    }

    function updateVideoPosition(e: MouseEvent) {
      if (!videoContainer) return;

      const offsetX = 20;
      const offsetY = 20;
      const rect = videoContainer.getBoundingClientRect();
      const videoWidth = rect.width || 200;
      const videoHeight = rect.height || 112;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;

      let left = e.clientX + offsetX;
      let top = e.clientY + offsetY;

      // Zorg dat video niet buiten scherm valt
      if (left + videoWidth > windowWidth) {
        left = e.clientX - videoWidth - offsetX;
      }
      if (top + videoHeight > windowHeight) {
        top = e.clientY - videoHeight - offsetY;
      }

      videoContainer.style.left = `${left}px`;
      videoContainer.style.top = `${top}px`;
    }

    function showVideo(link: Element | HTMLElement, videoUrl: string) {
      currentLink = link as HTMLElement;
      createVideoElement(videoUrl);
      
      if (videoContainer) {
        // Voeg visible class toe na korte delay voor smooth fade-in
        setTimeout(() => {
          if (videoContainer) {
            videoContainer.classList.add('visible');
          }
        }, 10);
      }

      // Update positie bij muisbeweging
      document.addEventListener('mousemove', updateVideoPosition);
    }

    function hideVideo() {
      currentLink = null;
      
      if (videoContainer) {
        videoContainer.classList.remove('visible');
        // Verwijder na fade-out
        setTimeout(() => {
          if (videoContainer) {
            videoContainer.remove();
            videoContainer = null;
          }
          if (videoElement) {
            videoElement.pause();
            videoElement = null;
          }
        }, 200);
      }

      // Verwijder mousemove listener
      document.removeEventListener('mousemove', updateVideoPosition);
    }

    // Voeg event listeners toe aan alle links met video
    linksWithVideo.forEach((link) => {
      const videoUrl = link.getAttribute('data-video-url');
      if (!videoUrl) return;

      const htmlLink = link as HTMLElement;
      htmlLink.addEventListener('mouseenter', () => {
        showVideo(htmlLink, videoUrl);
      });

      htmlLink.addEventListener('mouseleave', () => {
        hideVideo();
      });
    });
  }

  // Initialiseer bij page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initVideoHover);
  } else {
    initVideoHover();
  }

  // Herinitialiseer bij Astro page navigation
  document.addEventListener('astro:page-load', initVideoHover);
  document.addEventListener('astro:after-swap', initVideoHover);
</script>
