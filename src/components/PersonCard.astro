---
// Import Components & Scripts
import { Image } from 'astro:assets';
import { urlForImage } from '../sanity/lib/image';
import type { SanityImage } from '../sanity/types';

// Define Types
interface role {
  name?: string;
  description?: string;
}
interface Props{
  name?: string;
  roles?: role[];
  photo?: SanityImage;
}

// Define Vars
const {name, roles, photo} = Astro.props;

// Generate image URL - Sanity data only
let finalPhotoUrl = '';
let finalAltText = '';
let finalTitleText = '';

if (photo?.asset) {
  try {
    finalPhotoUrl = urlForImage(photo)?.width(400).height(400).url() || '';
    finalAltText = photo.alt || '';
    finalTitleText = photo.caption || '';
  } catch (error) {
    if (import.meta.env.DEV) {
      console.warn('Failed to generate photo URL in PersonCard:', error);
    }
  }
}

if (import.meta.env.DEV) {
  console.log('ðŸ‘¤ PersonCard received:', {
    name,
    hasPhoto: !!photo,
    photoUrl: finalPhotoUrl,
    rolesCount: roles?.length || 0
  });
}
---

<!-- Person -->
<div class="person">
  {finalPhotoUrl && (
    <div class="person-photo">
      <Image 
        src={finalPhotoUrl}
        inferSize
        widths={[200, 400, 800, 1200]}
        sizes="(max-width: 400px) 200px, (max-width: 800px) 400px, 800px"
        format="avif"
        alt={finalAltText || ""} 
        title={finalTitleText || ""}
        class="person-photo-img"
      />
    </div>
  )}
  <div class="person-details">
    <h3 class="person-name">{name}</h3>
    {roles && roles.length > 0 && (
      <div class="roles">
        <h4 class="person-roles">
          {roles.map((role: role) => role.name).filter(Boolean).join(', ')}
        </h4>
      </div>
    )}
  </div>
</div>


<style>
  h3.person-name, .person-roles {
    font-size: var(--fs--2);
    font-weight: 600;
    line-height: 133%;
  }

  .person-details{
    margin-top: var(--space-2xs);
  }

  .roles {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
    
  }

  .roles > * {
    
    
    opacity: 0.7;
    line-height: 112.5%;
  }
</style>