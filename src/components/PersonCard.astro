---
// Import Components & Scripts
import { Image } from 'astro:assets';
import { urlForImage } from '../../src/sanity/lib/image';
import type { SanityImage } from '../sanity/types';

// Define Types
interface role {
  name?: string;
  description?: string;
}
interface Props {
  name?: string;
  roles?: role[];
  photo?: SanityImage;
}

// Define Vars
const { name, roles, photo } = Astro.props;

// Generate image URL - Sanity data only
let finalPhotoUrl = '';
let finalAltText = '';
let finalTitleText = '';
const photoWidth = 1600;
const photoHeight = 2000;

if (photo?.asset) {
  try {
    // 4:5 aspect ratio: width 1600, height 2000 - hoge kwaliteit voor alle schermen
    finalPhotoUrl = urlForImage(photo)?.width(photoWidth).height(photoHeight).quality(90).url() || '';
    finalAltText = photo.alt || '';
    finalTitleText = photo.caption || '';
  } catch (error) {
    if (import.meta.env.DEV) {
      console.warn('Failed to generate photo URL in PersonCard:', error);
    }
  }
}

// if (import.meta.env.DEV) {
//   console.log('ðŸ‘¤ PersonCard received:', {
//     name,
//     hasPhoto: !!photo,
//     photoUrl: finalPhotoUrl,
//     rolesCount: roles?.length || 0,
//   });
// }
---

<!-- Person -->
<div class="person">
  {
    finalPhotoUrl && (
      <div class="person-photo">
        <Image
          src={finalPhotoUrl}
          width={photoWidth}
          height={photoHeight}
          widths={[400, 600, 800, 1200, 1600]}
          sizes="(max-width: 640px) 400px, (max-width: 1024px) 600px, (max-width: 1920px) 800px, 1200px"
          format="webp"
          quality={90}
          alt={finalAltText || ''}
          title={finalTitleText || ''}
          class="person-photo-img"
        />
      </div>
    )
  }
  <div class="grid gap-1 person-details">
    <h3 class="person-name">{name}</h3>
    {
      roles && roles.length > 0 && (
        <div class="roles">
          <h4 class="person-roles">
            {roles
              .map((role: role) => role.name)
              .filter(Boolean)
              .join(', ')}
          </h4>
        </div>
      )
    }
  </div>
</div>

<style>
  .person-name,
  .person-roles {
    font-size: var(--fs--2);
    font-weight: 400;
    line-height: 133%;
  }
  .person-name {
    font-size: var(--fs--1);
    font-weight: 500;
    letter-spacing: -0.0125em;
  }

  .person-details {
    margin-top: var(--space-2xs);
  }

  .roles {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
  }

  .roles > * {
    opacity: 0.7;
    line-height: 112.5%;
  }
</style>
