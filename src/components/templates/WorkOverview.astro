---
import PageTitle from '../PageTitle.astro';
import PageIntro from '../PageIntro.astro';
import ProjectList from '../ProjectList.astro';
import ProjectFilter from '../ProjectFilter.astro';
import { PortableText } from 'astro-portabletext';
import SanityLink from '../SanityLink.astro';

const { data } = Astro.props;
const pageTitle = data.title || '';
const pageIntroduction = data.introCols?.[0]?.content;
const projectData = data.work?.nodes || [];

// Extract services from Sanity structure (services is an array with title property)
const allServices = projectData
  .flatMap(
    (project: any) =>
      project.services?.map((service: any) => service.title) || [],
  )
  .filter(Boolean);

const uniqueServices = [...new Set(allServices)];

// PortableText components - gebruik SanityLink voor links in introCols
const components = {
  types: {},
  marks: {
    link: SanityLink,
  },
  block: {},
  list: {},
  listItem: {},
};
---

<PageTitle title={pageTitle} />
<PageIntro>
  {
    pageIntroduction && Array.isArray(pageIntroduction) ? (
      <Fragment slot="column-one">
        <PortableText value={pageIntroduction} components={components} />
      </Fragment>
    ) : null
  }
  <ProjectFilter services={uniqueServices} slot="column-two" />
</PageIntro>

<ProjectList projects={projectData} layout="list full" fitCards={true} />
